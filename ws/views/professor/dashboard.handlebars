<div class="card">
  <div class="card-body">
    <h5 class="card-title">Suas aulas:</h5>
    {{#each aulas}}
    <div class="card mb-3">
      <div class="card-body">
        <h6 class="card-subtitle mb-2 text-muted">
          Horário: {{ horario_inicio }} - {{ horario_fim }}
        </h6>
        <p class="card-text">Tipo: {{ tipo_aula }}</p>
        <p class="card-text">Matéria: {{ id_materia.nome_materia }}</p>
        <p class="card-text">Dia da semana: {{ dia_semana }}</p>
        <p class="card-text">Sala: {{ sala }}</p>
        <p class="card-text">Grupo: {{ grupo }}</p>
        <p class="card-text">Turma: {{ turma }}</p>
        <p class="card-text">Lab: {{ lab }}</p>
        <button class="btn btn-primary" onclick="generateQRCode('{{ _id }}')">Gerar QR Code</button>
        <button class="btn btn-secondary" onclick="generateRandomCode('{{ _id }}')">Gerar Código</button>
        <div class="code-container" id="code-container-{{ _id }}">
          {{#if codigoPresenca}}
            Código: {{ codigoPresenca }}
          {{/if}}
        </div>
      </div>
    </div>
    {{/each}}
  </div>
</div>

<script>
  function generateQRCode(aulaId) {
    // Implemente a lógica para gerar o QR Code com base no aulaId
  }

  function generateRandomCode(aulaId) {
    const codeContainer = document.getElementById(`code-container-${aulaId}`);
    if (codeContainer.innerText.trim() !== "") {
      return;
    }

    fetch(`/professor/gerar-codigo/${aulaId}`, {
      method: "POST",
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          codeContainer.innerText = `Código: ${data.codigo}`;
        } else {
          codeContainer.innerText = `Erro: ${data.message}`; // Exibe a mensagem de erro no container
          console.error("Erro ao gerar código:", data.message);
        }
      })
      .catch((error) => {
        console.error("Erro ao gerar código:", error);
      });
  }

  window.addEventListener("DOMContentLoaded", () => {
    const codeContainers = document.getElementsByClassName("code-container");
    Array.from(codeContainers).forEach((container) => {
      const code = container.getAttribute("data-code");
      if (code) {
        container.innerText = `Código: ${code}`;
      }
    });
  });
</script>

